<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dao.UserDAO">

    <!-- Insert User -->
    <insert id="insertUser" parameterType="dto.UserDTO">
        INSERT INTO user (email, password, nickname, gender, preferred_position, introduction)
        VALUES (#{email}, #{password}, #{nickname}, #{gender}, #{preferredPosition}, #{introduction})
    </insert>

    <!-- Select User by Email -->
    <select id="selectUserByEmail" parameterType="String" resultType="dto.UserDTO">
        SELECT user_id, email, password, nickname, created_at, gender, preferred_position, introduction, point, grade
        FROM user
        WHERE email = #{email}
    </select>

    <!-- Select User by ID -->
    <select id="selectUserById" parameterType="Long" resultType="dto.UserDTO">
        SELECT user_id, email, password, nickname, created_at, gender, preferred_position, introduction, point, grade
        FROM user
        WHERE user_id = #{userId}
    </select>

    <!-- Update User -->
    <update id="updateUser" parameterType="dto.UserDTO">
        UPDATE user
        SET email = #{email},
            password = #{password},
            nickname = #{nickname},
            preferred_position = #{preferredPosition},
            introduction = #{introduction}
        WHERE user_id = #{userId}
    </update>

    <!-- Delete User -->
    <delete id="deleteUser" parameterType="Long">
        DELETE FROM user
        WHERE user_id = #{userId}
    </delete>

    <!-- Select All Users (with sorting) -->
    <select id="selectAllUsers" parameterType="String" resultType="dto.UserDTO">
        SELECT user_id, email, password, nickname, created_at, gender, preferred_position, introduction, point, grade
        FROM user
        ORDER BY
        <choose>
            <when test="sortBy == 'grade'">
                grade DESC, point DESC
            </when>
            <when test="sortBy == 'nickname'">
                nickname ASC
            </when>
            <otherwise>
                point DESC, grade DESC
            </otherwise>
        </choose>
    </select>

</mapper>
